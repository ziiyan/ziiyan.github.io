<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        第二十一章 Ajax与Comet - undefined
        
    </title>

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/aircloud.css">

    
<link rel="stylesheet" href="/css/gitment.css">

    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
<meta name="generator" content="Hexo 4.2.0"></head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i> life kicks in right now </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar ">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <i>ziiyan</i>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>主页</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>标签</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>存档</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>关于</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>搜索</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#XMLHttpRequest-对象"><span class="toc-text">XMLHttpRequest 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XHR的用法"><span class="toc-text">XHR的用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP头部信息"><span class="toc-text">HTTP头部信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GET-请求"><span class="toc-text">GET 请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POST-请求"><span class="toc-text">POST 请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XMLHttpRequest-2-级"><span class="toc-text">XMLHttpRequest 2 级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#进度事件"><span class="toc-text">进度事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#跨资源共享-CORS"><span class="toc-text">跨资源共享 CORS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他跨域技术"><span class="toc-text">其他跨域技术</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#安全"><span class="toc-text">安全</span></a></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">搜索</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>

        <div class="index-about-mobile">
            <i> life kicks in right now </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        第二十一章 Ajax与Comet
    </div>

    <div class="post-meta">
        <span class="attr">发布于：<span>2020-03-13 00:20:44</span></span>
        
        <span class="attr">标签：/
        
        <a class="tag" href="/tags/#JavaScript高级程序设计" title="JavaScript高级程序设计">JavaScript高级程序设计</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">访问：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <p>AJAX - Asynchronous JavaScript + XML</p>
<p>向服务器请求额外的数据而无须卸载页面</p>
<p>核心是 XMLHttpRequest 对象，简称 XHR</p>
<p>使用 XHR 对象取得新数据，通过 DOM 将新数据插入页面</p>
<h2 id="XMLHttpRequest-对象"><a href="#XMLHttpRequest-对象" class="headerlink" title="XMLHttpRequest 对象"></a>XMLHttpRequest 对象</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br></pre></td></tr></table></figure>

<h3 id="XHR的用法"><a href="#XHR的用法" class="headerlink" title="XHR的用法"></a>XHR的用法</h3><ol>
<li><code>open(请求类型, URL, 是否异步)</code><ul>
<li>get / post</li>
<li>相对于当前页面 / 绝对路径</li>
<li>Boolean</li>
</ul>
</li>
<li><code>send(请求主体)</code><ul>
<li>无内容则传入 null</li>
</ul>
</li>
<li>收到响应后，自动填充 XHR 对象的属性<ul>
<li><code>responseText</code> 做为响应主体</li>
<li><code>responseXML</code> “text/xml” 或 “application/xml”</li>
<li><code>status</code> 响应的 HTTP 状态<ul>
<li>200 成功，responseText 就绪 </li>
<li>304 资源未修改，可使用缓存</li>
</ul>
</li>
<li><code>statusText</code> HTTP 状态的说明</li>
<li><code>readyState</code> 异步请求的活动阶段<ul>
<li>0 位初始化</li>
<li>1 启动</li>
<li>2 发送</li>
<li>3 接收</li>
<li>4 完成</li>
<li>值每次改变都触发 <code>readystatechange</code> 事件</li>
</ul>
</li>
<li>收到响应前调用 <code>abort()</code> 取消异步请求</li>
</ul>
</li>
</ol>
<h3 id="HTTP头部信息"><a href="#HTTP头部信息" class="headerlink" title="HTTP头部信息"></a>HTTP头部信息</h3><p>XHR 提供操作请求头部和响应头部信息的方法</p>
<p>默认情况，发送 XHR 请求的同时还会发送以下头部信息</p>
<ul>
<li>Accept：浏览器能够处理的内容类型</li>
<li>Accept-Charset：浏览器能够显示的字符集</li>
<li>Accept-Encoding：浏览器能够处理的压缩编码</li>
<li>Accept-Language：浏览器当前设置的语言</li>
<li>Connection：浏览器与服务器之间连接的类型</li>
<li>Cookie：当前页面设置的任何 Cookie</li>
<li>Host：发出请求的页面所在的域</li>
<li>Referer：发出请求的页面的 URI</li>
<li>User-Agent：浏览器的用户代理字符串</li>
</ul>
<ul>
<li><p><code>setRequestHeader(头部字段名称，头部字段值)</code> </p>
<ul>
<li>设置自定义的请求头部信息</li>
<li>open 之后 send 之前</li>
</ul>
</li>
<li><p><code>getRequestHeader(头部字段名称)</code></p>
</li>
<li><p><code>getAllResponseHeaders()</code></p>
</li>
</ul>
<h3 id="GET-请求"><a href="#GET-请求" class="headerlink" title="GET 请求"></a>GET 请求</h3><p>每个参数的名称和值必须使用 <code>encodeURIComponent()</code> 编码才能放到 URL 末尾，所有名-值对都由 &amp; 分隔</p>
<h3 id="POST-请求"><a href="#POST-请求" class="headerlink" title="POST 请求"></a>POST 请求</h3><p><code>serialize()</code> 格式化数据</p>
<h2 id="XMLHttpRequest-2-级"><a href="#XMLHttpRequest-2-级" class="headerlink" title="XMLHttpRequest 2 级"></a>XMLHttpRequest 2 级</h2><ul>
<li>FormData 序列化表单</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> data = <span class="keyword">new</span> FormData();</span><br><span class="line">data.append(键, 值);</span><br></pre></td></tr></table></figure>

<ul>
<li>超时设定 <code>timeout</code>属性</li>
</ul>
<p>open 之后 send 之前设定，请求在等待响应多少毫秒之后停止</p>
<p>触发 timeout 事件，调用 ontimeout 事件处理程序</p>
<ul>
<li><code>overrideMimeType()</code> 方法</li>
</ul>
<p>重写 XHR 响应的 MIME 类型，send 之前调用</p>
<h2 id="进度事件"><a href="#进度事件" class="headerlink" title="进度事件"></a>进度事件</h2><ul>
<li>loadstart：接收到响应数据的第一个字节时触发</li>
<li>progress：接收响应期间不断地触发</li>
<li>error：请求发生错误时触发</li>
<li>abort：在因为调用 abort() 方法而终止连接时触发</li>
<li>load：在接收到完整的响应数据时触发</li>
<li>loaded：在通信完成或者触发 error、abort 或 load 事件后触发</li>
</ul>
<h2 id="跨资源共享-CORS"><a href="#跨资源共享-CORS" class="headerlink" title="跨资源共享 CORS"></a>跨资源共享 CORS</h2><p>基本思想：使用自定义的 HTTP 头部让浏览器与服务器进行沟通</p>
<p>发送：<code>Origin：http://www...</code></p>
<p>接收：<code>Access-Control-Allow-Origin：http://www...</code></p>
<ul>
<li><p>在 XHR 对象的 open 中传入绝对 URL 可以请求跨域，：限制</p>
<ul>
<li>不能使用 setRequestHeader() 设置自定义头部</li>
<li>不能发送和接收 cookie</li>
<li>调用 getAllResponseHeaders() 会返回空字符串</li>
</ul>
</li>
<li><p>Preflighted Requests 透明服务器验证机制</p>
<ul>
<li>发送<ul>
<li>Origin：与简单的请求相同</li>
<li>Access-Control-Request-Method:请求自身使用的方法</li>
<li>Access-Control-Request-Headers:(可选)自定义的头部信息，多个头部以逗号分隔</li>
</ul>
</li>
<li>接收<ul>
<li>Access-Control-Allow-Origin：与简单的请求相同</li>
<li>Access-Control-Allow-Methods：允许的方法，多个方法以逗号分隔</li>
<li>Access-Control-Allow-Headers：允许的头部，多个头部以逗号分隔</li>
<li>Access-Control-Max-Age：应该将这个 Preflight 请求缓存多长时间(以秒表示)</li>
</ul>
</li>
</ul>
</li>
<li><p>带凭据的请求</p>
<ul>
<li>默认跨源请求不提供凭据（cookie、HTTP 认证及客户端 SSL 证明）</li>
<li>将 withCredentials 属性设置为 true 可以指定某个请求应该发送凭据</li>
<li>响应：<code>Access-Control-Allow-Credentials: true</code></li>
</ul>
</li>
<li><p>跨浏览器的 CROS</p>
<ul>
<li>所有浏览器都支持简单的（非 Preflight 和不带凭据的）请求</li>
</ul>
</li>
</ul>
<h2 id="其他跨域技术"><a href="#其他跨域技术" class="headerlink" title="其他跨域技术"></a>其他跨域技术</h2><ul>
<li>图像 Ping<ul>
<li><code>&lt;img&gt;</code> 标签</li>
<li>只能发送 GET 请求</li>
<li>无法访问服务器的响应文本</li>
</ul>
</li>
<li>JSONP - JSON with padding<ul>
<li>包含两部分：回调函数和数据</li>
<li>通过 <code>&lt;script&gt;</code> 元素使用</li>
<li>能直接访问响应文本</li>
<li>从其他域中加载代码执行，不安全</li>
<li>很难确定 JSONP 请求是否成功</li>
</ul>
</li>
<li>Comet 服务器推送<ul>
<li>长轮询：浏览器发送请求，服务器保持连接，直到有数据发送才发送数据。浏览器收到数据后关闭连接，再重新发起新请求</li>
<li>HTTP 流：浏览器发送请求，服务器保持连接，周期性地向浏览器发送数据</li>
</ul>
</li>
<li>SSE 服务器发送事件<ul>
<li>围绕只读 Comet 交互推出的 API 或者模式</li>
</ul>
</li>
<li>Web Socket<ul>
<li>单独的持久连接上提供全双工、双向通信</li>
</ul>
</li>
<li>SSE 与 Web Socket<ul>
<li>Web Socket 需要服务器支持，双向通信</li>
<li>SSE 不需要服务器支持，一般单向，结合 XHR 可以双向</li>
</ul>
</li>
</ul>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><ul>
<li>要求以 SSL 连接来访问可以通过 XHR 请求的资源</li>
<li>要求每一次请求都要附带经过响应算法计算得到的验证码</li>
</ul>
<p>以下措施对防范 CSRF（Cross-Saite Request Forgery）攻击不起作用</p>
<ul>
<li>要求发送 POST 而不是 GET —— 容易改变</li>
<li>检查来源 URL 以确定 是否可信 —— 容易伪造</li>
<li>基于 cookie 信息进行验证 ——容易伪造</li>
</ul>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>

        <div id="lv-container">
        </div>

    </div>
</div>

    </div>
</div>


<footer class="footer">
    <ul class="list-inline text-center">
        
        

        

        

        

        

    </ul>
    
    <p>
        <span id="busuanzi_container_site_pv">
            <span id="busuanzi_value_site_pv"></span>PV
        </span>
        <span id="busuanzi_container_site_uv">
            <span id="busuanzi_value_site_uv"></span>UV
        </span>
        Created By <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud" target="_blank" rel="noopener">AirCloud</a></p>
</footer>




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>

<script src="/js/index.js"></script>

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




</html>
