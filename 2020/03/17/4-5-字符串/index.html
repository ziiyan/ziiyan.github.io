<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>life kicks in right now</title>
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">life kicks in right now</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">Archives</a>
        </li>
      
        <li class="menu-item">
          <a href="https://github.com/ziiyan" target="_blank" rel="noopener" class="menu-item-link">Github</a>
        </li>
      
    </ul>
  </nav>
</header>
      <main class="main">
        <article class="post">
  <div class="post-title">
    <h2 class="title">字符串的扩展</h2>
  </div>
   <div class="post-meta">
    <span class="post-time">2020-03-17</span>
  </div>
  <div class="post-content">
    <h1 id="字符串的扩展"><a href="#字符串的扩展" class="headerlink" title="字符串的扩展"></a>字符串的扩展</h1><h2 id="字符的-Unicode-表示法"><a href="#字符的-Unicode-表示法" class="headerlink" title="字符的 Unicode 表示法"></a>字符的 Unicode 表示法</h2><ul>
<li>ES6 加强了对 Unicode 的支持，允许采用 <code>\uxxxx</code> 形式表示一个字符，<code>xxxx</code> 表示字符的 Unicode 码点</li>
<li>限制码点在 <code>\u0000</code> ~ <code>\uFFFF</code> 之间的字符，超出范围必须用两个双字节的形式表示</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"\uD842\uDFB7"</span></span><br><span class="line"><span class="comment">// "𠮷"</span></span><br><span class="line"></span><br><span class="line"><span class="string">"\u20BB7"</span></span><br><span class="line"><span class="comment">// " 7"</span></span><br><span class="line"><span class="comment">// JavaScript 会理解成 \u20BB+7</span></span><br><span class="line"><span class="comment">// \u20BB 不可打印，输出空格</span></span><br></pre></td></tr></table></figure>

<ul>
<li>只要将码点放入大括号，就能正确解读</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"\u&#123;20BB7&#125;"</span></span><br><span class="line"><span class="comment">// "𠮷"</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对编码仍然是一窍不通……</p>
</blockquote>
<h2 id="字符串的遍历器接口"><a href="#字符串的遍历器接口" class="headerlink" title="字符串的遍历器接口"></a>字符串的遍历器接口</h2><ul>
<li>ES6 对字符串添加了遍历器接口（详见《Iterator》一章），使得字符串可以被 <code>for...of</code> 循环便利</li>
<li>除了遍历字符串，遍历器最大的优点是可以识别大于 <code>0xFFFF</code> 的码点</li>
</ul>
<h2 id="直接输入-U-2028-和-U-2029"><a href="#直接输入-U-2028-和-U-2029" class="headerlink" title="直接输入 U+2028 和 U+2029"></a>直接输入 U+2028 和 U+2029</h2><ul>
<li>JavaScript 字符串允许直接输入字符，以及输入字符的转义形式</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'中'</span> === <span class="string">'\u4e2d'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>规定不能在字符串里直接使用，只能用转义形式<ul>
<li>U+005C：反斜杠</li>
<li>U+000D：回车</li>
<li>U+2028：行分隔符</li>
<li>U+2029：段分隔符</li>
<li>U+000A：换行符</li>
</ul>
</li>
<li>JSON 允许使用 U+2028、U+2029<ul>
<li><code>JSON.parse()</code> 解析这两个会报错</li>
<li>为了兼容 JSON，ES2019 支持直接输入这两个</li>
</ul>
</li>
</ul>
<h2 id="JSON-stringify-的改造"><a href="#JSON-stringify-的改造" class="headerlink" title="JSON.stringify() 的改造"></a>JSON.stringify() 的改造</h2><ul>
<li>根据标准，JSON 数据必须是 UTF-8 编码，但是现在的 <code>JSON.stringify()</code> 有可能返回不符合 UTF-8 标准的字符串</li>
</ul>
<blockquote>
<p>UTF-8 标准规定，<code>0xD800</code> 到 <code>0xDFFF</code> 之间的码点必须配对使用</p>
</blockquote>
<ul>
<li><code>JSON.stringify()</code> 可能返回 <code>0xD800</code> 到 <code>0xDFFF</code> 之间的单个码点</li>
<li>为了确保返回的是合法的 UTF-8 字符，如果遇到<code>0xD800</code>到<code>0xDFFF</code>之间的单个码点，或者不存在的配对形式，它会返回转义字符串，留给应用自己决定下一步的处理</li>
</ul>
<h2 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h2><ul>
<li>增强版的字符串，用反引号（`）标识</li>
<li>可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入 <code>${变量}</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">"Bob"</span>, time = <span class="string">"today"</span>;</span><br><span class="line"><span class="string">`Hello <span class="subst">$&#123;name&#125;</span>, how are you <span class="subst">$&#123;time&#125;</span>?`</span></span><br></pre></td></tr></table></figure>

<ul>
<li>反引号需要反斜杠转义</li>
<li>保留空格和缩进，可以用 <code>trim()</code> 方法消除</li>
<li>如果变量的值不是字符串，将按照一般的规则转为字符串<ul>
<li>比如，大括号中是一个对象，将默认调用对象的<code>toString</code>方法</li>
</ul>
</li>
</ul>
<h2 id="标签模板"><a href="#标签模板" class="headerlink" title="标签模板"></a>标签模板</h2><ul>
<li>模版字符串跟在一个函数名后面，该函数将被调用来处理这个模版字符串</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alert<span class="string">`hello`</span></span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line">alert([<span class="string">'hello'</span>])</span><br></pre></td></tr></table></figure>

<ul>
<li>标签模版其实不是模版，而是函数调用的一种特殊形式<ul>
<li>“标签” 指的是函数，跟在后面的模版字符串是参数</li>
</ul>
</li>
<li>如果有参数，函数会依次受到多个参数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tag</span>(<span class="params">stringArr, ...values</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">tag<span class="string">`Hello <span class="subst">$&#123;a + b&#125;</span> world <span class="subst">$&#123;a + b&#125;</span>`</span>;</span><br><span class="line"><span class="comment">//等同于</span></span><br><span class="line">tag([<span class="string">'Hello '</span>, <span class="string">' world '</span>, <span class="string">''</span>], <span class="number">15</span>, <span class="number">50</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>作用<ul>
<li>过滤 HTML 字符串，防止用户输入恶意内容</li>
<li>多语言转换</li>
<li>嵌入其他语言</li>
</ul>
</li>
<li>模版处理函数的第一个参数（模版字符串数组），还有一个 <code>raw</code> 属性，保存的是<strong>转义</strong>后的原字符串</li>
</ul>
<h2 id="模板字符串的限制"><a href="#模板字符串的限制" class="headerlink" title="模板字符串的限制"></a>模板字符串的限制</h2><ul>
<li>标签模板可以内嵌别的语言，默认将字符串转义，导致报错</li>
<li>ES2018 放松了对<u>标签模版</u>里面字符串转义的限制<ul>
<li>遇到不合法的字符串转义，返回 <code>undefined</code></li>
<li><code>raw</code> 属性上仍可以得到原始字符串</li>
</ul>
</li>
<li>不是标签模版仍然会报错</li>
</ul>
<h1 id="字符串的新增方法"><a href="#字符串的新增方法" class="headerlink" title="字符串的新增方法"></a>字符串的新增方法</h1><h2 id="String-fromCodePoint"><a href="#String-fromCodePoint" class="headerlink" title="String.fromCodePoint()"></a>String.fromCodePoint()</h2><ul>
<li>ES5 提供 <code>String.fromCharCode()</code> 方法从 Unicode 码点返回对应字符，不能识别大于 <code>0xFFFF</code> 的字符</li>
<li>ES6 提供 <code>String.fromCodePoint()</code> 可识别大于 <code>0xFFFF</code> 的字符<ul>
<li>多个参数会被合并成一个字符串返回</li>
</ul>
</li>
<li><code>fromCodePoint</code> 方法定义在 <code>String</code> 对象上</li>
<li><code>codePointAt</code> 方法定义在字符串的实例对象上</li>
</ul>
<h2 id="String-raw"><a href="#String-raw" class="headerlink" title="String.raw()"></a>String.raw()</h2><ul>
<li><p>替换所有变量，并对斜杠进行转义</p>
</li>
<li><p>实现</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">String</span>.raw = <span class="function"><span class="keyword">function</span> (<span class="params">strings, ...values</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> output = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">let</span> index;</span><br><span class="line">  <span class="keyword">for</span> (index = <span class="number">0</span>; index &lt; values.length; index++) &#123;</span><br><span class="line">    output += strings.raw[index] + values[index];</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  output += strings.raw[index]</span><br><span class="line">  <span class="keyword">return</span> output;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实例方法：codePointAt"><a href="#实例方法：codePointAt" class="headerlink" title="实例方法：codePointAt()"></a>实例方法：codePointAt()</h2><ul>
<li>JavaScript 内部，字符以 UTF-16 的格式存储，每个字符固定 2 字节</li>
<li>大于 <code>0xFFFF</code> 的字符需要 4 个字节存储，JavaScript 会认为它们是两个字符，字符串长度为 2</li>
<li>ES5 <code>charCodeAt()</code> 只能 2 个字节 2 个字节处理</li>
<li>ES6 <code>codePointAt()</code> 能够正确处理 4 个字节</li>
<li><code>codePointAt()</code> 返回的码点是十进制的，toString(16) 转为十六进制</li>
</ul>
<h2 id="实例方法：normalize"><a href="#实例方法：normalize" class="headerlink" title="实例方法：normalize()"></a>实例方法：normalize()</h2><ul>
<li>合成符号</li>
</ul>
<h2 id="实例方法：includes-startsWith-endsWith"><a href="#实例方法：includes-startsWith-endsWith" class="headerlink" title="实例方法：includes(), startsWith(), endsWith()"></a>实例方法：includes(), startsWith(), endsWith()</h2><ul>
<li>ES5 <code>indexOf</code> 可以确定一个字符串是否包含在另一个字符串中</li>
<li>ES6<ul>
<li><code>includes(&#39;subString&#39;, n)</code> 返回布尔值，表示是否找到了参数字符串</li>
<li><code>startsWith(&#39;subString&#39;, n)</code> 返回布尔值，表示参数字符串是否在原字符串的头部</li>
<li><code>endsWith(&#39;subString&#39;, n)</code> 返回布尔值，表示参数字符串是否在原字符串的尾部</li>
</ul>
</li>
</ul>
<h2 id="实例方法：repeat-n"><a href="#实例方法：repeat-n" class="headerlink" title="实例方法：repeat(n)"></a>实例方法：repeat(n)</h2><ul>
<li>返回一个新字符串，重复 n 次</li>
<li>小数取整，负数/Infinity 报错</li>
</ul>
<h2 id="实例方法：padStart-n-‘string’-padEnd-n-‘string’"><a href="#实例方法：padStart-n-‘string’-padEnd-n-‘string’" class="headerlink" title="实例方法：padStart(n, ‘string’), padEnd(n, ‘string’)"></a>实例方法：padStart(n, ‘string’), padEnd(n, ‘string’)</h2><ul>
<li>补全长度<ul>
<li>长度 n</li>
<li>用来补全的字符串 string</li>
</ul>
</li>
</ul>
<h2 id="实例方法：trimStart-trimEnd"><a href="#实例方法：trimStart-trimEnd" class="headerlink" title="实例方法：trimStart(), trimEnd()"></a>实例方法：trimStart(), trimEnd()</h2><ul>
<li>消除空格</li>
<li>不修改原始字符</li>
</ul>
<h2 id="实例方法：matchAll"><a href="#实例方法：matchAll" class="headerlink" title="实例方法：matchAll()"></a>实例方法：matchAll()</h2><ul>
<li><code>matchAll()</code>返回一个正则表达式在当前字符串的所有匹配</li>
<li>详见 6-正则的扩展</li>
</ul>

  </div>
</article>
      </main>
    </div>
  </body>
</html>