<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>life kicks in right now</title>
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">life kicks in right now</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">Archives</a>
        </li>
      
        <li class="menu-item">
          <a href="https://github.com/ziiyan" target="_blank" rel="noopener" class="menu-item-link">Github</a>
        </li>
      
    </ul>
  </nav>
</header>
      <main class="main">
        <article class="post">
  <div class="post-title">
    <h2 class="title">前端缓存</h2>
  </div>
   <div class="post-meta">
    <span class="post-time">2020-07-21</span>
  </div>
  <div class="post-content">
    <h1 id="HTTP-缓存"><a href="#HTTP-缓存" class="headerlink" title="HTTP 缓存"></a>HTTP 缓存</h1><h2 id="1、缓存的判断策略"><a href="#1、缓存的判断策略" class="headerlink" title="1、缓存的判断策略"></a>1、缓存的判断策略</h2><h3 id="1-1、存储策略"><a href="#1-1、存储策略" class="headerlink" title="1.1、存储策略"></a>1.1、存储策略</h3><ul>
<li>发生在收到请求响应后</li>
<li>用于决定是否缓存相应资源</li>
</ul>
<h3 id="1-2、过期策略"><a href="#1-2、过期策略" class="headerlink" title="1.2、过期策略"></a>1.2、过期策略</h3><ul>
<li>发生在请求前</li>
<li>用于判断缓存是否过期</li>
</ul>
<h3 id="1-3、协商策略"><a href="#1-3、协商策略" class="headerlink" title="1.3、协商策略"></a>1.3、协商策略</h3><ul>
<li>发生在请求中</li>
<li>用于判断缓存资源是否更新</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/MpGQUHiaib4ib49yrHAQicnnlN8I2aFBFp66xQGD623d7kG6CnZcV1ruWC4wW1lqRLgxFuejMIULiaMicFaZaDtblThQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p>
<p>浏览器下访问资源的方式主要有以下7种：</p>
<ol>
<li>(新标签)地址栏回车</li>
<li>链接跳转</li>
<li>前进、后退</li>
<li>从收藏栏打开链接</li>
<li>(window.open)新开窗口</li>
<li>刷新（Command + R / F5）</li>
<li>强制刷新（Command + Shift + R / Ctrl + F5）</li>
</ol>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/MpGQUHiaib4ib49yrHAQicnnlN8I2aFBFp668KIXEzsZ1NDTpYAt9MYu32flx46pkOkD7yRvdwGNIbeUXLG8xG9CmQ/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p>
<h2 id="2、缓存基础"><a href="#2、缓存基础" class="headerlink" title="2、缓存基础"></a>2、缓存基础</h2><p>缓存又分为强缓存和弱缓存（又称为协商缓存），区别是<strong>获取资源时是否会发送请求</strong>。</p>
<h3 id="2-1、强缓存"><a href="#2-1、强缓存" class="headerlink" title="2.1、强缓存"></a>2.1、强缓存</h3><ul>
<li>包括 Expires 和 Cache-Control</li>
<li>过期策略生效时应用的缓存</li>
</ul>
<h3 id="2-2、弱缓存"><a href="#2-2、弱缓存" class="headerlink" title="2.2、弱缓存"></a>2.2、弱缓存</h3><ul>
<li>包括 Last-Modified 和 ETag</li>
<li>协商策略后应用的缓存</li>
</ul>
<h3 id="2-3、HTTP-相关字段"><a href="#2-3、HTTP-相关字段" class="headerlink" title="2.3、HTTP 相关字段"></a>2.3、HTTP 相关字段</h3><h4 id="2-3-1、Expires（1-0）"><a href="#2-3-1、Expires（1-0）" class="headerlink" title="2.3.1、Expires（1.0）"></a>2.3.1、Expires（1.0）</h4><ul>
<li>指定缓存的过期时间，为绝对时间</li>
<li>响应头字段</li>
<li>参考本地时间进行比对，在指定时刻后过期</li>
<li>因此修改本地时间就会失效</li>
</ul>
<h4 id="2-3-2、Cache-Control"><a href="#2-3-2、Cache-Control" class="headerlink" title="2.3.2、Cache-Control"></a>2.3.2、Cache-Control</h4><ul>
<li>指定资源的缓存机制</li>
<li>同时在请求头和响应头中设定</li>
<li>涉及存储策略、过期策略</li>
</ul>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/MpGQUHiaib4ib49yrHAQicnnlN8I2aFBFp66uQQMWK9OIiaUL53ttvZQLY7VsXfuE8tnKKMThZ0O3hcbSW6VVX3H3Tw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="img"></p>
<h5 id="2-3-2-1、cache-directive-大小写不敏感"><a href="#2-3-2-1、cache-directive-大小写不敏感" class="headerlink" title="2.3.2.1、cache-directive 大小写不敏感"></a>2.3.2.1、cache-directive 大小写不敏感</h5><h5 id="2-3-2-2、在请求头中的-max-age"><a href="#2-3-2-2、在请求头中的-max-age" class="headerlink" title="2.3.2.2、在请求头中的 max-age"></a>2.3.2.2、在请求头中的 max-age</h5><ul>
<li><code>max-age=&lt;seconds&gt;</code></li>
<li>客户端不接受有效时间大于指定时间的缓存</li>
<li>Chrome和Firefox浏览器下的刷新操作（Command+ R / F5）均是在请求头上添加了max-age=0指令，表示<strong>不使用强缓存，但允许协商缓存</strong></li>
</ul>
<h5 id="2-3-2-3、max-age-优先级高于-Expires"><a href="#2-3-2-3、max-age-优先级高于-Expires" class="headerlink" title="2.3.2.3、max-age 优先级高于 Expires"></a>2.3.2.3、max-age 优先级高于 Expires</h5><h5 id="2-3-2-4、no-cache-和-no-store"><a href="#2-3-2-4、no-cache-和-no-store" class="headerlink" title="2.3.2.4、no-cache 和 no-store"></a>2.3.2.4、no-cache 和 no-store</h5><ul>
<li>no-cache：跳过强缓存，强制进入协商策略</li>
<li>no-store：不缓存</li>
</ul>
<h4 id="2-3-3、Pragma（1-0）"><a href="#2-3-3、Pragma（1-0）" class="headerlink" title="2.3.3、Pragma（1.0）"></a>2.3.3、Pragma（1.0）</h4><ul>
<li>通常设置为<code>Pragma:no-cache</code>，作用与<code>Cache-Control:no-cache</code>相同</li>
<li>当在浏览器进行强刷（Comand + Shift + R / Ctrl + F5）或在NetWork面板内勾选禁用缓存（Disable Caches）时，会自动带上<code>Pragma:no-cache</code>和<code>Cache-Control:no-cache</code>，<strong>并且不会带上协商策略中所涉及的信息（下面介绍的If-Modified-Since/If-None-Match）</strong>。这时不会使用任何缓存，重新获取资源</li>
</ul>
<h4 id="2-3-4、Last-Modified-If-Modified-Since-If-Unmodified-Since"><a href="#2-3-4、Last-Modified-If-Modified-Since-If-Unmodified-Since" class="headerlink" title="2.3.4、Last-Modified / If-Modified-Since / If-Unmodified-Since"></a>2.3.4、Last-Modified / If-Modified-Since / If-Unmodified-Since</h4><ul>
<li><code>Last-Modified</code>用于标记请求资源的最后一次修改时间</li>
<li>返回的资源带有<code>Last-Modified</code>标识时，再次请求该资源，浏览器会自动带上<code>If-Modified-Since</code>，值为返回的<code>Last-Modified</code>值</li>
<li>请求到达服务器后，服务器进行判断，如果从上次更新后没有再更新，则返回304。如果更新了则重新返回</li>
<li><code>If-Modified-Since</code> 只能用于 GET、HEAD</li>
<li><code>If-Unmodified-Since</code> 表示资源未修改则正常执行更新，否则返回412</li>
</ul>
<h4 id="2-3-5、ETag-If-Match-If-None-Match"><a href="#2-3-5、ETag-If-Match-If-None-Match" class="headerlink" title="2.3.5、ETag / If-Match / If-None-Match"></a>2.3.5、ETag / If-Match / If-None-Match</h4><ul>
<li><p>ETag是请求资源在服务器的唯一标识，浏览器可以根据ETag值缓存数据</p>
</li>
<li><p>再次请求时通过 If-None-Match 携带上次的 ETag 值</p>
<ul>
<li>如果值不变，则返回304</li>
<li>如果改变则返回新的内容</li>
</ul>
</li>
<li><p><strong>ETag的优先级高于Last-Modified</strong></p>
</li>
</ul>
<h2 id="3、缓存的优缺点"><a href="#3、缓存的优缺点" class="headerlink" title="3、缓存的优缺点"></a>3、缓存的优缺点</h2><p>![image-20200721172953127](/Users/wuziyan/Library/Application Support/typora-user-images/image-20200721172953127.png)</p>
<h1 id="浏览器缓存"><a href="#浏览器缓存" class="headerlink" title="浏览器缓存"></a>浏览器缓存</h1><h1 id="应用程序缓存"><a href="#应用程序缓存" class="headerlink" title="应用程序缓存"></a>应用程序缓存</h1>
  </div>
</article>
      </main>
    </div>
  </body>
</html>