<!DOCTYPE html>
<html>
  <head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  <title>life kicks in right now</title>
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">life kicks in right now</a>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">Home</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">Archives</a>
        </li>
      
        <li class="menu-item">
          <a href="https://github.com/ziiyan" target="_blank" rel="noopener" class="menu-item-link">Github</a>
        </li>
      
    </ul>
  </nav>
</header>
      <main class="main">
        <article class="post">
  <div class="post-title">
    <h2 class="title">Vue.js 性能优化实践</h2>
  </div>
   <div class="post-meta">
    <span class="post-time">2020-07-20</span>
  </div>
  <div class="post-content">
    <h2 id="1、webpack-bundle-analyzer"><a href="#1、webpack-bundle-analyzer" class="headerlink" title="1、webpack-bundle-analyzer"></a>1、<a href="https://www.npmjs.com/package/webpack-bundle-analyzer" target="_blank" rel="noopener">webpack-bundle-analyzer</a></h2><ul>
<li>可视化的方式分析 bundle 打包情况</li>
<li>针对性优化</li>
</ul>
<h4 id="INSTALL"><a href="#INSTALL" class="headerlink" title="INSTALL"></a>INSTALL</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-bundle-analyzer</span><br></pre></td></tr></table></figure>

<h4 id="USAGE"><a href="#USAGE" class="headerlink" title="USAGE"></a>USAGE</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vue.config.js</span></span><br><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">     <span class="keyword">new</span> BundleAnalyzerPlugin()</span><br><span class="line">      ...</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里主要发现两个问题：</p>
<h2 id="1-1、组件替换不完全"><a href="#1-1、组件替换不完全" class="headerlink" title="1.1、组件替换不完全"></a>1.1、组件替换不完全</h2><ul>
<li>Vuetify</li>
</ul>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>删除这个包</p>
<h2 id="1-2、第三方包未按需引入"><a href="#1-2、第三方包未按需引入" class="headerlink" title="1.2、第三方包未按需引入"></a>1.2、第三方包未按需引入</h2><ul>
<li>ant design</li>
<li>lodash</li>
</ul>
<h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><p>使用 babel-plugin-import 将 js 和 css 按需引入 <a href>原理</a></p>
<h2 id="2、gZip"><a href="#2、gZip" class="headerlink" title="2、gZip"></a>2、gZip</h2><ul>
<li>服务器发送压缩包，浏览器进行解压</li>
<li>目的是减少资源传输时间</li>
<li>客户端发送请求时 <code>Accept-Encoding</code> 字段说明自己接受哪些压缩方法</li>
<li>服务器发送资源时 <code>Content-Encoding</code> 字段说明数据的压缩方法</li>
<li>如果服务器在接收到请求时才进行压缩，然后压缩好再发送，压缩时间就会被用户感知</li>
</ul>
<h3 id="解决方案-2"><a href="#解决方案-2" class="headerlink" title="解决方案"></a>解决方案</h3><p>使用 compression-webpack-plugin 在前端项目打包时就进行压缩</p>
<ul>
<li>test：正则匹配需要压缩的文件</li>
<li>threshold：超过阈值进行压缩</li>
<li>deleteOriginalAssets：是否删除原文件</li>
</ul>
<p>这边由于保留了原文件及压缩包，所以打包出来的 dist 文件会比之前大，但对传输来说不影响</p>
<h2 id="3、代码分割"><a href="#3、代码分割" class="headerlink" title="3、代码分割"></a>3、代码分割</h2><ul>
<li>把代码分离到不同的 bundle 中，可以按需加载或并行加载这些文件</li>
<li>常用的代码分离方法有三种：<ul>
<li>入口起点：使用 <a href="https://webpack.docschina.org/configuration/entry-context" target="_blank" rel="noopener"><code>entry</code></a> 配置手动地分离代码</li>
<li>防止重复：使用 <a href="https://webpack.docschina.org/plugins/split-chunks-plugin" target="_blank" rel="noopener"><code>SplitChunksPlugin</code></a> 去重和分离 chunk</li>
<li>动态导入：通过模块的内联函数调用来分离代码<ul>
<li>在代码中自动将使用 <code>import()</code> 加载的模块分离成独立的包</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="3-1、提取公共代码"><a href="#3-1、提取公共代码" class="headerlink" title="3.1、提取公共代码"></a>3.1、提取公共代码</h2><ul>
<li>相同的资源被重复加载，浪费用户的流量和服务器的成本</li>
<li>每个页面需要加载的资源太大，导致网页首屏加载缓慢，影响用户体验</li>
<li>将多个页面的公共代码抽离成单独的文件</li>
</ul>
<h3 id="解决方案-3"><a href="#解决方案-3" class="headerlink" title="解决方案"></a>解决方案</h3><p>splitChunks</p>
<h2 id="3-2、Vue-js-路由懒加载"><a href="#3-2、Vue-js-路由懒加载" class="headerlink" title="3.2、Vue.js 路由懒加载"></a>3.2、Vue.js 路由懒加载</h2><ul>
<li><p>把不同路由对应的组件分割成不同的代码块，当路由被访问的时候才加载对应组件</p>
</li>
<li><p>结合 Vue 的<a href="https://cn.vuejs.org/v2/guide/components-dynamic-async.html#异步组件" target="_blank" rel="noopener">异步组件</a>和 Webpack 的<a href="https://doc.webpack-china.org/guides/code-splitting-async/#require-ensure-/" target="_blank" rel="noopener">代码分割功能</a></p>
</li>
</ul>
<h2 id="4、预渲染"><a href="#4、预渲染" class="headerlink" title="4、预渲染"></a>4、预渲染</h2><h2 id="5、浏览器缓存"><a href="#5、浏览器缓存" class="headerlink" title="5、浏览器缓存"></a>5、浏览器缓存</h2><h2 id="6、CDN"><a href="#6、CDN" class="headerlink" title="6、CDN"></a>6、CDN</h2><ul>
<li>Content Delivery Network，内容分发网络</li>
<li>使用户可就近取得所需内容，解决Internet网络拥挤的状况，提高用户访问网站的响应速度</li>
</ul>

  </div>
</article>
      </main>
    </div>
  </body>
</html>